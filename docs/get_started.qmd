---
title: Get started with polarstate
jupyter: python3
---

This is a reproducible example that shows how to use polarstate, and compare the outputs to {lifelines} package.

First:
Import polars as a dependency:

```{python}
import polars as pl
```


# Competing Risks Example

::: {.panel-tabset}

## polarstate (Py üêç)

```{python}

from polarstate import prepare_event_table

times_and_reals = pl.DataFrame({
    "times": [24.1, 9.7, 49.9, 18.6, 34.8, 14.2, 39.2, 46.0, 31.5, 4.3],
    "reals": [1, 1, 1, 1, 0, 2, 1, 2, 0, 1]
})

event_table = prepare_event_table(times_and_reals)

print(event_table)

```

### Prediction for Specific Time-Horizons


```{python}
from polarstate import predict_aj_estimates

predict_aj_estimates(event_table, pl.Series([10.0, 20.0, 30.0, 40.0, 50.0]))

```

## lifelines (Py üêç)

```{python}

import pandas as pd
from lifelines import AalenJohansenFitter

df = pd.DataFrame({
    "duration": [24.1, 9.7, 49.9, 18.6, 34.8, 14.2, 39.2, 46.0, 31.5, 4.3],
    "event":    [1, 1, 1, 1, 0, 2, 1, 2, 0, 1]
})

ajf_priamry = AalenJohansenFitter()
ajf_priamry.fit(df["duration"], df["event"], event_of_interest=1)

print("Event Table for event type 1")
print(ajf_priamry.cumulative_density_)

ajf_competing = AalenJohansenFitter()
ajf_competing.fit(df["duration"], df["event"], event_of_interest=2)

print("Event Table for event type 2")
print(ajf_competing.cumulative_density_)



```

### Prediction for Specific Time-Horizons

```{python}
print("Cumulative incidence for event type 1 at times 10.0, 20.0, 30.0, 40.0, 50.0:")
print(ajf_priamry.predict([10.0, 20.0, 30.0, 40.0, 50.0]))

print("Cumulative incidence for event type 2 at times 10.0, 20.0, 30.0, 40.0, 50.0:")
print(ajf_competing.predict([10.0, 20.0, 30.0, 40.0, 50.0]))

```


## tidycmprsk (R üîµ)

```{r}
library(tidycmprsk)
cuminc(Surv(ttdeath, death_cr) ~ 1, trial)

times_and_reals <- data.frame(
  times = c(24.1, 9.7, 49.9, 18.6, 34.8, 14.2, 39.2, 46.0, 31.5, 4.3),
  reals = factor(c(1, 1, 1, 1, 0, 2, 1, 2, 0, 1),
                 levels = c(0, 1, 2),
                 labels = c("censored", "primary_event", "competing_event"))
)

(cuminc(Surv(times, reals) ~ 1, times_and_reals)) |>
    tidy() |>
    print()

```

:::

# No Compating Risks Example


::: {.panel-tabset}


## polarstate (Py üêç)


```{python}

from lifelines import AalenJohansenFitter
from lifelines.datasets import load_waltons
from polarstate import prepare_event_table


T, E = load_waltons()['T'], load_waltons()['E']

times_and_reals = pl.DataFrame({
        "times": T,
        "reals": E
    })

result = prepare_event_table(times_and_reals)

print(result)
```




## lifelines (Py üêç)


```{python}

from lifelines import AalenJohansenFitter
from lifelines.datasets import load_waltons
T, E = load_waltons()['T'], load_waltons()['E']
ajf = AalenJohansenFitter(calculate_variance=True)
ajf.fit(T, E, event_of_interest=1)
ajf.cumulative_density_


```



:::

# Performance Comparison

Here we compare the performance of `polarstate` and `lifelines` for the same task.

```{python}
import timeit

import pandas as pd
import polars as pl
from lifelines import AalenJohansenFitter
from lifelines.datasets import load_waltons

from polarstate import prepare_event_table

# Load the dataset
T, E = load_waltons()["T"], load_waltons()["E"]

# Prepare data for polarstate
polarstate_data = pl.DataFrame({"times": T, "reals": E})

# Prepare data for lifelines
lifelines_data = pd.DataFrame({"duration": T, "event": E})


# Time polarstate
polarstate_time = timeit.timeit(
    "prepare_event_table(polarstate_data)",
    globals=globals(),
    number=100,
)

# Time lifelines
ajf = AalenJohansenFitter(calculate_variance=True)
lifelines_time = timeit.timeit(
    'ajf.fit(lifelines_data["duration"], lifelines_data["event"], event_of_interest=1)',
    globals=globals(),
    number=100,
)

print(f"polarstate execution time: {polarstate_time:.4f} seconds (for 100 executions)")
print(f"lifelines execution time: {lifelines_time:.4f} seconds (for 100 executions)")
```